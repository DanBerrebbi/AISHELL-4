# data_preparation
0. Download datasets

Librispeech: http://www.openslr.org/12/

MUSAN: http://www.openslr.org/17/

Audioset: https://github.com/marc-moreaux/audioset_raw

AISHELL-1: http://www.openslr.org/33/

aidatatang_200zh: http://www.openslr.org/62/

Primewords: http://www.openslr.org/47/



1. Simulate RIRs
```bash 
export LD_LIBRARY_PATH=/path/to/data_preparation/:$LD_LIBRARY_PATH
python generate_rir_trainingdata.py --output_dir path/to/output/path
```
Please make sure that your Python version is higher than 3.6. If you use real recorded RIR, this step is not required. Pyrirgen comes from https://github.com/phecda-xu/RIR-Generator

2. Simulate isotropic noise

```bash 
python generate_isotropic_noise.py --output_dir path/to/output/path --wavnum 200
```

3. Prepare the training data of fe model:
```bash
python generate_fe_trainingdata.py --spk1_list path/to/wavlist/of/speaker1 --spk2_list path/to/wavlist/of/speaker2 --noise_list path/to/wavlist/of/noise --rir_list path/to/wavlist/of/rir --isotropic_list path/to/wavlist/of/isotropicnoise --mode train or dev --output_dir path/to/output/dir --wavnum we suggest 60000 for train and 3000 for dev
```

4. Prepare the training data of asr model:
```bash
python generate_asr_trainingdata.py --wav_list path/to/wavlist/of/cleanspeech --noise_list path/to/wavlist/of/noise --rir_list path/to/wavlist/of/rir --output_dir path/to/output/dir --mode train or dev
```

5. Prepare the evaluation data of Speaker Independent task:
```bash
python generate_nospk_testdata.py --wav_list path/to/wavlist/of/aishell4-test --textgrid_list path/to/textgridlist/of/aishell4-test --output_dir path/to/output/dir 
```

6. Prepare the evaluation data of Speaker Dependent task:
Note: Before running, please make a dir named 'rttm_sd' under current path and copy the rttms generated by sd system to 'rttm_sd'
```bash
python generate_spk_testdata.py --wav_list path/to/wavlist/of/aishell4-test --textgrid_list path/to/textgridlist/of/aishell4-test --output_dir path/to/output/dir 
```
